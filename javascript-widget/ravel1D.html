<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <meta charset="utf-8">
  <style>
    .tooltip {
    position: relative;
    display: inline-block;
    border-bottom: 1px dotted black;
    }

    .tooltip .tooltiptext {
    visibility: hidden;
    width: 120px;
    background-color: black;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px 0;
    position: absolute;
    z-index: 1;
    bottom: 150%;
    left: 50%;
    margin-left: -60px;
    }

    .tooltip .tooltiptext::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: black transparent transparent transparent;
    }

    .tooltip:hover .tooltiptext {
    visibility: visible;
    }

    .md-content {
    visibility: hidden;
    background: #ffffff;
    position: fixed;
    border-style: ridge;
    border-radius: 3px;
    padding: 3px;
    margin: 0 auto;
    }

    .ravelCanvas {
    position: absolute;
    }
  </style>
  
  <body onunload="onunload()">

    <h1>Ravel!</h1>

    <!-- partial reduction model overlays -->
    <div class="md-content" id="binModal">
      <h3><center>Binning Parameters</center></h3>
      <select id="binOp">
        <option value="add">+</option>
        <option value="multiply">×</option>
      </select>
      Bin size <input type="number" value="1" id="binSize"/>
      <br/>
      <button onclick='closeModal("binModal")'>Cancel</button>
      <button onclick='partialReductionModalOK("bin")'>OK</button>
    </div>
    
    <div class="md-content" id="scanModal">
      <h3><center>Scanning Parameters</center></h3>
      <select id="scanOp">
        <option value="add">+</option>
        <option value="multiply">×</option>
      </select>
      Window <input type="number" value="1" id="scanSize"/>
      <br/>
      <button onclick='closeModal("scanModal")'>Cancel</button>
      <button onclick='partialReductionModalOK("scan")'>OK</button>
    </div>
    
     <div class="md-content" id="changeModal">
      <h3><center>Change Parameters</center></h3>
      <select id="changeOp">
        <option value="subtract">Δ</option>
        <option value="divide">ratio</option>
        <option value="relative">rel</option>
        <option value="percent">%</option>
      </select>
      Offset <input type="number" value="1" id="changeSize"/>
      <br/>
      <button onclick='closeModal("changeModal")'>Cancel</button>
      <button onclick='partialReductionModalOK("change")'>OK</button>
    </div>
   
    <table id="tableBlock">
      <tr>
        <td>
          Database:
        </td>
        <td>
          <span id="tableSelector1lhsWrap">
            <select id="tableSelector1lhs"
           onchange="setTable(this.value,ravel1.lhs);
           hideAxisMenus('ravel1Axes'); plotData(ravel1)">
            </select>
          </span>
          <select id="op1" onchange="handleOpSelector(ravel1)">
            <option value="+">+</option>
            <option value="-">-</option>
            <option value="*">×</option>
            <option selected="1" value="/">̣÷</option>
            <option value="custom" onclick="handleOpSelectorOnClick(ravel1)">JS</option>
          </select>
          <span id="tableSelector1rhsWrap">
            <select id="tableSelector1rhs"
                    onchange="setTable(this.value,ravel1.rhs);
                              hideAxisMenus('ravel1Axes'); plotData(ravel1)">
            </select>
          </span>
        </td>
        <td>
          Database:
        </td>
        <span id="tableSelector2lhsWrap">
          <td>
            <select id="tableSelector2lhs"
                    onchange="setTable(this.value,ravel2.lhs);
                              hideAxisMenus('ravel1Axes'); plotData(ravel2)">
            </select>
          </span>
          <select id="op2" onchange="handleOpSelector(ravel2);">
            <option value="+">+</option>
            <option value="-">-</option>
            <option value="*">×</option>
            <option selected="1" value="/">̣÷</option>
            <option value="custom" onclick="handleOpSelectorOnClick(ravel2)">JS</option>
          </select>
          <span id="tableSelector2rhsWrap">
            <select id="tableSelector2rhs"
                    onchange="setTable(this.value,ravel2.rhs);
                              hideAxisMenus('ravel2Axes'); plotData(ravel2)">
            </select>
          </span>
        </td>
      </tr>
      <tr>
        <td/>
        <td>
          <table id="ravel1Axes"></table>
        </td>
        <td/>
        <td>
          <table id="ravel2Axes"></table>
        </td>
          </tr>
          <tr>
            <td style="height:300px">
              <table>
                <tr><td>
                    <input type="button"
                           onclick="toggleAxisMenus('ravel1Axes',ravel1.master)"
                           value="toggle axis menus"/>
                </td></tr>
                <tr><td><input type="radio" name="ravel1Selector"
                               onchange="switchRavel(ravel1,'','ravel1')"/>Master</td></tr>
                <tr><td><input type="radio" name="ravel1Selector"
                               onchange="switchRavel(ravel1,'lhs','ravel1')"/>LHS</td></tr>
                <tr><td><input type="radio" name="ravel1Selector"
                               onchange="switchRavel(ravel1,'rhs','ravel1')"/>RHS</td></tr>
              </table>
            </td>
            <td valign="top">
                <canvas width="300" height="300" class="ravelCanvas" id="ravel1" tabindex="10"></canvas>
                <canvas width="300" height="300" class="ravelCanvas" id="ravel1lhs" style="visibility:hidden" tabindex="20"></canvas>
                <canvas width="300" height="300" class="ravelCanvas"
              id="ravel1rhs" style="visibility:hidden"
                      tabindex="30"></canvas>
            </td>
            <td>
              <table>
                <tr><td>
                    <input type="button"
                           onclick="toggleAxisMenus('ravel2Axes',ravel2.master)"
                           value="toggle axis menus"/>
                </td></tr>
                <tr><td><input type="radio" name="ravel2Selector"
                               onchange="switchRavel(ravel2,'','ravel2')"/>Master</td></tr>
                <tr><td><input type="radio" name="ravel2Selector"
                               onchange="switchRavel(ravel2,'lhs','ravel2')"/>LHS</td></tr>
                <tr><td><input type="radio" name="ravel2Selector"
                               onchange="switchRavel(ravel2,'rhs','ravel2')"/>RHS</td></tr>
                <tr><td><input type="checkbox" checked id="slaved"/>Slaved</td></tr>
              </table>
            </td>
            <td valign="top">
              <canvas width="300" height="300" class="ravelCanvas" id="ravel2" tabindex="11"></canvas>
              <canvas width="300" height="300" class="ravelCanvas" id="ravel2lhs" style="visibility:hidden" tabindex="21"></canvas>
              <canvas width="300" height="300" class="ravelCanvas" id="ravel2rhs" style="visibility:hidden" tabindex="31"></canvas>
       </td>
      </tr>
    </table>

    <select id="plotType" onchange="plotAllData();">
      <option value="scatter">line chart</option>
      <option value="bar" selected="1">bar chart</option>
    </select>
    <input id="y1min" oninput="plotAllData()" value="min left"/>
    <input id="y1max" oninput="plotAllData()" value="max left"/>
    <input id="y2min" oninput="plotAllData()" value="min right"/>
    <input id="y2max" oninput="plotAllData()" value="max right"/>
    <input type="checkbox" checked id="allDomain" value="0" onchange="plotAllData()"/>Whole domain

    <div id="plot" style="width:1000px;height:400px;"></div>
    <center>
      <small>
        Ravel version <div id="ravelVersion"></div>
      </small>
    </center>
    
    <script type="text/javascript" src="plotly.min.js"></script>
    <!-- jsravel.js is not freeware - 
    please purchase a license at http://ravelation.hpcoders.com.au -->
    <script type="text/javascript" src="jsravel.js"></script>
    <script type="text/javascript" src="ravel-1dplotly.js"></script>
    <script type="text/javascript" src="ravel.js"></script>
    <script>
      var ravel1=new Ravel1D("ravel1");
      var ravel2=new Ravel1D("ravel2");
      // if we're the desktop app running under electron, customise    stuff here
      if (typeof(process) != 'undefined'
      && process.versions && process.versions.electron)
      {
        require("./desktop.js");
      }
      else
      {
        populateTableSelector("tableSelector1lhs");
        populateTableSelector("tableSelector1rhs");
        populateTableSelector("tableSelector2lhs");
        populateTableSelector("tableSelector2rhs");
      }
      function onunload() {
        if (ravel1) {ravel1.delete();}
        if (ravel2) {ravel2.delete();}
      }
      document.getElementById("ravelVersion").innerHTML=ravel1.master.version();
   </script>
    
  </body>
</html> 
